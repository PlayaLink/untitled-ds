# Plan Comparison: Sonnet 4.5 vs Opus 4.5

**Date:** 2026-01-08

This document compares the two implementation plans generated by different Claude models for the Unified Design System project.

---

## Executive Summary

| Metric | Sonnet 4.5 | Opus 4.5 | Winner |
|--------|------------|----------|--------|
| Config files to create | 11 | 7 | Opus |
| Tailwind 4 integration | Incorrect | Correct | Opus |
| Critical bugs identified | 0 | 3 | Opus |
| Unnecessary dependencies | 3 | 0 | Opus |
| Troubleshooting depth | Basic | Detailed | Opus |

**Recommendation:** Use the Opus 4.5 plan - it's more minimal and catches critical integration issues.

---

## Files to Create Comparison

### Sonnet 4.5 (11 files)

1. `package.json`
2. `tsconfig.json`
3. `tsconfig.node.json` ❌ *unnecessary*
4. `vite.config.ts` ❌ *not needed for Storybook-only*
5. `figma.config.json`
6. `.storybook/main.ts`
7. `.storybook/preview.tsx`
8. `.storybook/manager.ts` ❌ *optional theming*
9. `src/styles/globals.css`
10. `src/components/button/button.tsx`
11. `src/components/button/button.stories.tsx`
12. `src/components/button/button.figma.tsx`

### Opus 4.5 (7 files)

1. `package.json`
2. `tsconfig.json`
3. `figma.config.json`
4. `.storybook/main.ts`
5. `.storybook/preview.ts`
6. `src/styles/globals.css`
7. `src/utils/cx.ts` ✅ *critical for Untitled UI*

### Analysis

- Opus removes 4 unnecessary files
- Opus adds 1 critical file (`cx.ts`) that Sonnet missed
- Net result: 7 vs 11 files (36% reduction)

---

## Dependencies Comparison

### package.json differences

| Dependency | Sonnet 4.5 | Opus 4.5 | Notes |
|------------|------------|----------|-------|
| `clsx` | ✅ Included | ❌ Removed | Opus uses tailwind-merge instead |
| `tailwind-merge` | ❌ Missing | ✅ Included | Required for Untitled UI pattern |
| `@storybook/addon-links` | ✅ Included | ❌ Removed | Not essential |
| `@storybook/blocks` | ✅ Included | ❌ Removed | Auto-included with essentials |
| `@tailwindcss/vite` | ❌ Missing | ✅ Included | **CRITICAL** for Tailwind 4 |

### Sonnet package.json (partial)
```json
{
  "dependencies": {
    "clsx": "^2.1.1"
  },
  "devDependencies": {
    "@storybook/addon-links": "^8.5.0",
    "@storybook/blocks": "^8.5.0"
  }
}
```

### Opus package.json (partial)
```json
{
  "dependencies": {
    "tailwind-merge": "^3.0.0"
  },
  "devDependencies": {
    "@tailwindcss/vite": "^4.1.0"
  }
}
```

---

## Critical Bugs in Sonnet Plan

### Bug 1: Missing @tailwindcss/vite Plugin

**Sonnet .storybook/main.ts:**
```typescript
viteFinal: async (config) => {
  config.resolve = config.resolve || {}
  config.resolve.alias = {
    ...config.resolve.alias,
    '@': path.resolve(__dirname, '../src'),
  }
  return config
}
```

**Opus .storybook/main.ts:**
```typescript
viteFinal: async (config) => {
  const { default: tailwindcss } = await import('@tailwindcss/vite')
  return mergeConfig(config, {
    plugins: [tailwindcss()],
    resolve: {
      alias: {
        '@': resolve(__dirname, '../src'),
      },
    },
  })
}
```

**Impact:** Without `@tailwindcss/vite`, Tailwind 4.1 styles **will not work** in Storybook. This is a breaking bug.

### Bug 2: Missing cx.ts Utility

**Sonnet:** Does not include `src/utils/cx.ts`

**Opus:** Includes `src/utils/cx.ts`:
```typescript
import { twMerge } from 'tailwind-merge'

export function cx(...classes: (string | undefined | null | false)[]): string {
  return twMerge(classes.filter(Boolean).join(' '))
}
```

**Impact:** Untitled UI components use `cx()` for class merging. Without this utility, imported components will fail with "cx is not defined" errors.

### Bug 3: Wrong Class Utility

**Sonnet:** Uses `clsx` for class conditionals

**Opus:** Uses `tailwind-merge` via `cx()` function

**Impact:** Untitled UI is built around `tailwind-merge`, not `clsx`. Using `clsx` won't properly merge conflicting Tailwind classes (e.g., `bg-red-500 bg-blue-500` should resolve to `bg-blue-500`).

---

## globals.css Comparison

### Sonnet (Tailwind 3 syntax)
```css
@import 'tailwindcss';

/* Import design tokens */
@import './tokens.css';

/* Base styles */
body {
  font-family: theme('fontFamily.body');
  color: theme('colors.gray.900');
  background-color: theme('colors.base.white');
}
```

### Opus (Tailwind 4 with @config)
```css
@import 'tailwindcss';
@config '../../tailwind.config.js';
@import './tokens.css';
```

### Analysis

- Opus uses `@config` directive to load existing `tailwind.config.js`
- This allows Tailwind 4 to use the existing design tokens without migration
- Sonnet's approach would require migrating to CSS-first config or fail silently

---

## TypeScript Configuration Comparison

### Sonnet tsconfig.json
```json
{
  "compilerOptions": {
    "target": "ES2022",
    "useDefineForClassFields": true,
    "lib": ["ES2022", "DOM", "DOM.Iterable"],
    "module": "ESNext",
    "skipLibCheck": true,
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "resolveJsonModule": true,
    "isolatedModules": true,
    "noEmit": true,
    "jsx": "react-jsx",
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "noFallthroughCasesInSwitch": true,
    "baseUrl": ".",
    "paths": {
      "@/*": ["./src/*"],
      "@/components/*": ["./src/components/*"]
    }
  },
  "include": ["src"],
  "references": [{ "path": "./tsconfig.node.json" }]
}
```

### Opus tsconfig.json
```json
{
  "compilerOptions": {
    "target": "ES2022",
    "lib": ["ES2022", "DOM", "DOM.Iterable"],
    "module": "ESNext",
    "moduleResolution": "bundler",
    "jsx": "react-jsx",
    "strict": true,
    "noEmit": true,
    "skipLibCheck": true,
    "resolveJsonModule": true,
    "isolatedModules": true,
    "baseUrl": ".",
    "paths": {
      "@/*": ["./src/*"]
    }
  },
  "include": ["src", ".storybook"]
}
```

### Differences

| Option | Sonnet | Opus | Notes |
|--------|--------|------|-------|
| `useDefineForClassFields` | ✅ | ❌ | Default is fine |
| `allowImportingTsExtensions` | ✅ | ❌ | Not needed |
| `noUnusedLocals` | ✅ | ❌ | Too strict for initial setup |
| `noUnusedParameters` | ✅ | ❌ | Too strict for initial setup |
| `noFallthroughCasesInSwitch` | ✅ | ❌ | Optional |
| `@/components/*` path alias | ✅ | ❌ | `@/*` covers this |
| tsconfig.node.json reference | ✅ | ❌ | Not needed |
| `.storybook` in include | ❌ | ✅ | Required for type checking |

---

## Component Template Comparison

### Sonnet Button Component
```tsx
import { Button as AriaButton, ButtonProps as AriaButtonProps } from 'react-aria-components'
import { clsx } from 'clsx'

export function Button({ ... }) {
  return (
    <AriaButton
      className={clsx(
        'inline-flex items-center justify-center...',
        { 'px-3 py-1.5': size === 'sm' },
        { 'bg-brand-600': variant === 'primary' && !destructive }
      )}
    >
      {children}
    </AriaButton>
  )
}
```

### Opus Button Component
```tsx
import { Button as AriaButton, type ButtonProps as AriaButtonProps } from 'react-aria-components'
import { cx } from '@/utils/cx'

export function Button({ ... }) {
  return (
    <AriaButton
      className={cx(
        'inline-flex items-center justify-center...',
        size === 'sm' && 'px-3 py-1.5',
        variant === 'primary' && 'bg-brand-600'
      )}
    >
      {children}
    </AriaButton>
  )
}
```

### Differences

| Aspect | Sonnet | Opus |
|--------|--------|------|
| Class utility | `clsx` | `cx` (tailwind-merge) |
| Object syntax | `{ 'class': condition }` | `condition && 'class'` |
| Type import | `ButtonProps` | `type ButtonProps` |

Opus pattern is cleaner and matches Untitled UI's actual codebase.

---

## Troubleshooting Comparison

### Sonnet (5 items, basic)
1. Path aliases not working
2. Tailwind classes not applying
3. Code Connect not finding components
4. Untitled UI adds too much code
5. Figma properties don't match

### Opus (7 items, detailed with prevention)

| Issue | Symptom | Prevention |
|-------|---------|------------|
| Tailwind styles not working | Components unstyled | Use `@tailwindcss/vite` in viteFinal |
| Path aliases not resolving | Import errors | Match paths in tsconfig AND viteFinal |
| Code Connect not finding files | Publish fails | Check `include` glob in figma.config.json |
| Untitled UI components too complex | Too many variants | Expected - strip after import |
| Figma property names don't match | Mapping fails | Property names are case-sensitive |
| `cx` is not defined | Runtime error | Create `src/utils/cx.ts` first |
| Tailwind config not found | No styles | Use `@config` directive in globals.css |

---

## Storybook Configuration Comparison

### Sonnet (.storybook/preview.tsx)
```tsx
import type { Preview } from '@storybook/react'
import '../src/styles/tokens.css'
import '../src/styles/globals.css'

const preview: Preview = {
  parameters: {
    controls: {
      matchers: {
        color: /(background|color)$/i,
        date: /Date$/i,
      },
    },
    layout: 'centered',
  },
}

export default preview
```

### Opus (.storybook/preview.ts)
```typescript
import type { Preview } from '@storybook/react'
import '../src/styles/globals.css'

const preview: Preview = {
  parameters: {
    layout: 'centered',
  },
}

export default preview
```

### Differences

- Opus removes matchers config (defaults are fine)
- Opus imports only `globals.css` (which imports `tokens.css`)
- File extension: `.tsx` vs `.ts` (both work, `.ts` is simpler)

---

## Documentation Depth Comparison

| Section | Sonnet | Opus |
|---------|--------|------|
| Executive summary | ✅ | ✅ |
| Tech stack rationale | Basic | Detailed |
| What could go wrong | Listed | Table with prevention |
| Critical success factors | Listed | Prioritized |
| Existing plan analysis | N/A | ✅ Reviewed Sonnet's issues |
| File count justification | No | Yes |
| Dependency rationale | No | Yes |

---

## Recommendations

### Use Opus 4.5 Plan Because:

1. **Catches critical bugs** - Tailwind 4 integration would have failed with Sonnet plan
2. **More minimal** - 7 files vs 11 files
3. **Correct dependencies** - Uses `tailwind-merge` + `cx.ts` as Untitled UI expects
4. **Better troubleshooting** - Prevention-focused documentation
5. **Tailwind 4 @config** - Properly handles existing tailwind.config.js

### Minor Improvements to Consider:

1. Add Sonnet's `@storybook/manager.ts` if you want custom Storybook theming later
2. Add Sonnet's stricter TypeScript options (`noUnusedLocals`) after initial setup works
3. Keep Sonnet's `@/components/*` path alias if you prefer explicit imports

---

## Quick Start (Using Opus Plan)

```bash
# Create the 7 files as specified in implementation-plan-opus-4.5.md
# Then:
npm install
npm run dev
# Storybook opens at http://localhost:6006

# Add first component:
npx untitledui@latest login
npx untitledui@latest add button --path src/components
# Strip to match Figma, create story, create figma.tsx

# Publish to Code Connect:
export FIGMA_ACCESS_TOKEN=your_token
npm run figma:publish
```
