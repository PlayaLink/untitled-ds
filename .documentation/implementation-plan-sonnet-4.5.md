# Implementation Plan: Untitled Design System with Figma Code Connect

**Generated by:** Claude Sonnet 4.5 (claude-sonnet-4-5-20250929)
**Date:** 2026-01-08

---

## Overview

Transform the current token-only system into a complete component library with Storybook documentation and Figma Code Connect integration. Philosophy: **BARE MINIMUM** - no excess complexity.

## Goal

Build a streamlined design system with perfect Figma ↔ Code parity:
1. Simplify Untitled UI components in Figma (remove excess variants)
2. Import via Untitled UI CLI and strip unnecessary code
3. Document all variants in Storybook with full props controls
4. Link components bidirectionally using Figma Code Connect
5. Publish Storybook to Vercel (future phase)

## Tech Stack

- **React 19.1** + TypeScript 5.8
- **Tailwind CSS 4.1** (already configured)
- **React Aria 1.9** (accessibility primitives)
- **Storybook 8.x** (documentation)
- **Vite 6.0** (build tool - faster than Next.js for this use case)
- **Figma Code Connect CLI** (design-code linking)
- **Untitled UI CLI** (component scaffolding)

## Implementation Steps

### Phase 1: Project Initialization

#### 1.1 Create package.json

```json
{
  "name": "untitled-ds",
  "version": "0.1.0",
  "private": true,
  "type": "module",
  "scripts": {
    "dev": "storybook dev -p 6006",
    "build": "npm run build:tokens && storybook build",
    "build:tokens": "node scripts/build-tokens.js",
    "preview": "storybook build && npx http-server ./storybook-static",
    "figma:connect": "figma connect publish",
    "figma:auth": "figma connect auth",
    "add:component": "npx untitledui@latest add"
  },
  "dependencies": {
    "react": "^19.1.0",
    "react-dom": "^19.1.0",
    "react-aria-components": "^1.9.0",
    "clsx": "^2.1.1"
  },
  "devDependencies": {
    "@figma/code-connect": "^1.2.0",
    "@storybook/addon-essentials": "^8.5.0",
    "@storybook/addon-links": "^8.5.0",
    "@storybook/blocks": "^8.5.0",
    "@storybook/react": "^8.5.0",
    "@storybook/react-vite": "^8.5.0",
    "@types/react": "^19.1.0",
    "@types/react-dom": "^19.1.0",
    "@vitejs/plugin-react": "^4.3.0",
    "storybook": "^8.5.0",
    "tailwindcss": "^4.1.0",
    "typescript": "^5.8.0",
    "vite": "^6.0.0"
  }
}
```

#### 1.2 Create TypeScript Configuration

**File:** `tsconfig.json`
```json
{
  "compilerOptions": {
    "target": "ES2022",
    "useDefineForClassFields": true,
    "lib": ["ES2022", "DOM", "DOM.Iterable"],
    "module": "ESNext",
    "skipLibCheck": true,
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "resolveJsonModule": true,
    "isolatedModules": true,
    "noEmit": true,
    "jsx": "react-jsx",
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "noFallthroughCasesInSwitch": true,
    "baseUrl": ".",
    "paths": {
      "@/*": ["./src/*"],
      "@/components/*": ["./src/components/*"]
    }
  },
  "include": ["src"],
  "references": [{ "path": "./tsconfig.node.json" }]
}
```

**File:** `tsconfig.node.json`
```json
{
  "compilerOptions": {
    "composite": true,
    "skipLibCheck": true,
    "module": "ESNext",
    "moduleResolution": "bundler",
    "allowSyntheticDefaultImports": true
  },
  "include": ["vite.config.ts", ".storybook"]
}
```

#### 1.3 Create Vite Configuration

**File:** `vite.config.ts`
```typescript
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'
import path from 'path'

export default defineConfig({
  plugins: [react()],
  resolve: {
    alias: {
      '@': path.resolve(__dirname, './src'),
      '@/components': path.resolve(__dirname, './src/components'),
    },
  },
})
```

#### 1.4 Create Figma Code Connect Configuration

**File:** `figma.config.json`
```json
{
  "codeConnect": {
    "include": ["src/components/**/*.figma.tsx"],
    "documentUrlSubstitutions": {
      "FIGMA_FILE_KEY": "99BhJBqUTbouPjng6udcbz"
    },
    "paths": {
      "@/*": ["./src/*"],
      "@/components/*": ["./src/components/*"]
    }
  }
}
```

#### 1.5 Create Storybook Configuration

**Directory:** `.storybook/`

**File:** `.storybook/main.ts`
```typescript
import type { StorybookConfig } from '@storybook/react-vite'
import path from 'path'

const config: StorybookConfig = {
  stories: ['../src/components/**/*.stories.tsx'],
  addons: [
    '@storybook/addon-essentials',
    '@storybook/addon-links',
  ],
  framework: {
    name: '@storybook/react-vite',
    options: {},
  },
  core: {
    disableTelemetry: true,
  },
  viteFinal: async (config) => {
    config.resolve = config.resolve || {}
    config.resolve.alias = {
      ...config.resolve.alias,
      '@': path.resolve(__dirname, '../src'),
      '@/components': path.resolve(__dirname, '../src/components'),
    }
    return config
  },
}

export default config
```

**File:** `.storybook/preview.tsx`
```tsx
import type { Preview } from '@storybook/react'
import '../src/styles/tokens.css'
import '../src/styles/globals.css'

const preview: Preview = {
  parameters: {
    controls: {
      matchers: {
        color: /(background|color)$/i,
        date: /Date$/i,
      },
    },
    layout: 'centered',
  },
}

export default preview
```

**File:** `.storybook/manager.ts`
```typescript
import { addons } from '@storybook/manager-api'
import { create } from '@storybook/theming/create'

addons.setConfig({
  theme: create({
    base: 'light',
    brandTitle: 'Untitled Design System',
    brandUrl: 'https://github.com/your-username/untitled-ds',
  }),
})
```

#### 1.6 Create Global Styles

**File:** `src/styles/globals.css`
```css
@import 'tailwindcss';

/* Import design tokens */
@import './tokens.css';

/* Base styles */
body {
  font-family: theme('fontFamily.body');
  color: theme('colors.gray.900');
  background-color: theme('colors.base.white');
}

/* Focus visible styles for accessibility */
*:focus-visible {
  outline: 2px solid theme('colors.brand.600');
  outline-offset: 2px;
}
```

#### 1.7 Update .gitignore

Add to existing `.gitignore`:
```
# Dependencies
node_modules/
package-lock.json

# Build outputs
dist/
storybook-static/

# Environment
.env
.env.local

# TypeScript
*.tsbuildinfo
```

#### 1.8 Setup Environment Variables

Update `.env.example`:
```
FIGMA_ACCESS_TOKEN=figd_your_token_here
FIGMA_DESIGN_SYSTEM_FILE_KEY=99BhJBqUTbouPjng6udcbz
```

Create `.env` (not committed):
```bash
cp .env.example .env
# Add your actual Figma token
```

### Phase 2: First Component Implementation (Test Pattern)

Use Button component to validate the entire workflow.

#### 2.1 Import Component from Untitled UI

```bash
npx untitledui@latest login
npx untitledui@latest add button --path src/components
```

#### 2.2 Create Component File Structure

**Directory:** `src/components/button/`

**File:** `src/components/button/button.tsx`

Strip Untitled UI code to match simplified Figma design:

```tsx
import { Button as AriaButton, ButtonProps as AriaButtonProps } from 'react-aria-components'
import { clsx } from 'clsx'

export interface ButtonProps extends Omit<AriaButtonProps, 'className'> {
  variant?: 'primary' | 'secondary' | 'tertiary'
  size?: 'sm' | 'md' | 'lg'
  destructive?: boolean
}

export function Button({
  variant = 'primary',
  size = 'md',
  destructive = false,
  children,
  ...props
}: ButtonProps) {
  return (
    <AriaButton
      className={clsx(
        // Base styles
        'inline-flex items-center justify-center gap-2 rounded-md font-semibold transition-colors',
        'focus:outline-none focus-visible:ring-2 focus-visible:ring-brand-600',

        // Size variants
        {
          'px-3 py-1.5 text-sm': size === 'sm',
          'px-4 py-2 text-md': size === 'md',
          'px-5 py-2.5 text-lg': size === 'lg',
        },

        // Variant styles
        {
          'bg-brand-600 text-white hover:bg-brand-700': variant === 'primary' && !destructive,
          'bg-error-600 text-white hover:bg-error-700': variant === 'primary' && destructive,
          'border border-gray-300 bg-white text-gray-700 hover:bg-gray-50': variant === 'secondary',
          'text-gray-700 hover:bg-gray-50': variant === 'tertiary',
        }
      )}
      {...props}
    >
      {children}
    </AriaButton>
  )
}
```

#### 2.3 Create Storybook Story

**File:** `src/components/button/button.stories.tsx`

```tsx
import type { Meta, StoryObj } from '@storybook/react'
import { Button } from './button'

const meta = {
  title: 'Components/Button',
  component: Button,
  parameters: {
    layout: 'centered',
    design: {
      type: 'figma',
      url: 'https://www.figma.com/design/99BhJBqUTbouPjng6udcbz/Unified-Design-System--Untitled-UI-?node-id=REPLACE_WITH_ACTUAL_NODE_ID',
    },
  },
  tags: ['autodocs'],
  argTypes: {
    variant: {
      control: 'select',
      options: ['primary', 'secondary', 'tertiary'],
      description: 'Visual style variant',
    },
    size: {
      control: 'select',
      options: ['sm', 'md', 'lg'],
      description: 'Size of the button',
    },
    destructive: {
      control: 'boolean',
      description: 'Applies destructive styling (red colors)',
    },
  },
} satisfies Meta<typeof Button>

export default meta
type Story = StoryObj<typeof meta>

export const Primary: Story = {
  args: {
    children: 'Button',
    variant: 'primary',
    size: 'md',
  },
}

export const Secondary: Story = {
  args: {
    children: 'Button',
    variant: 'secondary',
  },
}

export const Tertiary: Story = {
  args: {
    children: 'Button',
    variant: 'tertiary',
  },
}

export const Sizes: Story = {
  render: () => (
    <div className="flex items-center gap-4">
      <Button size="sm">Small</Button>
      <Button size="md">Medium</Button>
      <Button size="lg">Large</Button>
    </div>
  ),
}

export const Destructive: Story = {
  args: {
    children: 'Delete',
    destructive: true,
  },
}

export const Disabled: Story = {
  args: {
    children: 'Disabled',
    isDisabled: true,
  },
}

// LAST PAGE - Figma Link
export const Figma: Story = {
  render: () => (
    <div className="flex flex-col items-center gap-6 p-8">
      <div className="text-center">
        <h2 className="text-xl font-semibold mb-2">Figma Source</h2>
        <p className="text-gray-600 mb-4">
          This component was built from the following Figma design
        </p>
      </div>
      <a
        href="https://www.figma.com/design/99BhJBqUTbouPjng6udcbz/Unified-Design-System--Untitled-UI-?node-id=REPLACE_WITH_ACTUAL_NODE_ID"
        target="_blank"
        rel="noopener noreferrer"
        className="inline-flex items-center gap-2 px-6 py-3 bg-brand-600 text-white rounded-lg hover:bg-brand-700 transition-colors font-medium"
      >
        <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
          <path d="M4 5.33333C4 4.09733 5.00267 3.09467 6.23867 3.09467H9.76133C10.9973 3.09467 12 4.09733 12 5.33333C12 6.56933 10.9973 7.572 9.76133 7.572H6.23867C5.00267 7.572 4 6.56933 4 5.33333Z" fill="currentColor"/>
          <path d="M4 10.6667C4 9.43067 5.00267 8.428 6.23867 8.428H9.76133C10.9973 8.428 12 9.43067 12 10.6667C12 11.9027 10.9973 12.9053 9.76133 12.9053H6.23867C5.00267 12.9053 4 11.9027 4 10.6667Z" fill="currentColor"/>
        </svg>
        View in Figma
      </a>
    </div>
  ),
  parameters: {
    docs: {
      disable: true,
    },
  },
}
```

#### 2.4 Create Code Connect Mapping

**File:** `src/components/button/button.figma.tsx`

```tsx
import { figma } from '@figma/code-connect'
import { Button } from './button'

figma.connect(
  Button,
  'https://www.figma.com/design/99BhJBqUTbouPjng6udcbz/Unified-Design-System--Untitled-UI-?node-id=REPLACE_WITH_ACTUAL_NODE_ID',
  {
    props: {
      variant: figma.enum('Variant', {
        Primary: 'primary',
        Secondary: 'secondary',
        Tertiary: 'tertiary',
      }),
      size: figma.enum('Size', {
        Small: 'sm',
        Medium: 'md',
        Large: 'lg',
      }),
      destructive: figma.boolean('Destructive'),
      children: figma.string('Text'),
      isDisabled: figma.boolean('Disabled'),
    },
    example: ({ variant, size, destructive, children, isDisabled }) => (
      <Button
        variant={variant}
        size={size}
        destructive={destructive}
        isDisabled={isDisabled}
      >
        {children}
      </Button>
    ),
  }
)
```

### Phase 3: Installation & Testing

#### 3.1 Install Dependencies

```bash
npm install
```

#### 3.2 Build Design Tokens

```bash
npm run build:tokens
```

Verify `src/styles/tokens.css` is generated.

#### 3.3 Authenticate with Figma Code Connect

```bash
npm run figma:auth
```

Paste Figma personal access token with:
- **Code Connect scope**: Write
- **File content scope**: Read

#### 3.4 Start Storybook

```bash
npm run dev
```

Opens at `http://localhost:6006`

Verify:
- ✅ Button component appears under "Components/Button"
- ✅ All stories render correctly
- ✅ Props controls work in Storybook UI
- ✅ Figma tab shows link to design
- ✅ Tailwind styles apply correctly

#### 3.5 Publish to Code Connect

```bash
npm run figma:connect
```

Then verify in Figma:
1. Open the Figma design file
2. Select the Button component
3. Enter Dev Mode (top right)
4. Click "Inspect" panel
5. Verify code snippet appears from your repository

### Phase 4: Per-Component Workflow (Repeatable Pattern)

For each new component, follow this checklist:

#### Step 1: Figma Preparation (User)
- [ ] Simplify component in Figma
- [ ] Remove excess variants/properties
- [ ] Share Figma URL with node-id

#### Step 2: Verify Component (Claude)
- [ ] Review Figma component
- [ ] Verify no orphaned variants
- [ ] List all properties and variants
- [ ] Confirm 1:1 mapping possible

#### Step 3: Import & Strip
```bash
npx untitledui@latest add [component-name] --path src/components
```
- [ ] Strip unnecessary code from Untitled UI
- [ ] Match props to Figma exactly
- [ ] Keep only needed Tailwind classes

#### Step 4: Create Story
- [ ] Create `[component-name].stories.tsx`
- [ ] Add all variant stories
- [ ] Add Figma tab (LAST PAGE)

#### Step 5: Create Code Connect
- [ ] Create `[component-name].figma.tsx`
- [ ] Map Figma properties to props
- [ ] Test example rendering

#### Step 6: Test
```bash
npm run dev
```
- [ ] All stories render
- [ ] Props controls work
- [ ] Figma link works

#### Step 7: Publish
```bash
npm run figma:connect
```
- [ ] Verify in Figma Dev Mode

#### Step 8: Commit
```bash
git add src/components/[component-name]
git commit -m "feat(components): add [component-name] component

- Import from Untitled UI
- Strip to match Figma design
- Add Storybook stories
- Configure Code Connect"
```

## Project Structure After Implementation

```
untitled-ds/
├── .storybook/                       # NEW
│   ├── main.ts
│   ├── preview.tsx
│   └── manager.ts
│
├── src/
│   ├── components/                   # NEW
│   │   └── button/                   # NEW (example)
│   │       ├── button.tsx
│   │       ├── button.stories.tsx
│   │       └── button.figma.tsx
│   │
│   └── styles/
│       ├── tokens.css                # EXISTS
│       └── globals.css               # NEW
│
├── package.json                      # NEW
├── tsconfig.json                     # NEW
├── tsconfig.node.json                # NEW
├── vite.config.ts                    # NEW
├── figma.config.json                 # NEW
├── tailwind.config.js                # EXISTS
├── CLAUDE.md                         # EXISTS (update after implementation)
└── ... (existing files)
```

## Critical Files to Create

1. `package.json` - Dependencies and scripts
2. `tsconfig.json` + `tsconfig.node.json` - TypeScript config
3. `vite.config.ts` - Build tool config
4. `figma.config.json` - Code Connect config
5. `.storybook/main.ts` - Storybook config
6. `.storybook/preview.tsx` - Global Storybook settings
7. `.storybook/manager.ts` - Storybook theme
8. `src/styles/globals.css` - Global styles
9. `src/components/button/button.tsx` - First component (pattern)
10. `src/components/button/button.stories.tsx` - First story (pattern)
11. `src/components/button/button.figma.tsx` - First mapping (pattern)

## Verification Steps

After implementation, verify:

1. **Storybook runs**: `npm run dev` → `http://localhost:6006`
2. **Button component renders** with all variants
3. **Props controls work** in Storybook UI
4. **Figma tab** shows and links correctly
5. **Code Connect publishes**: `npm run figma:connect`
6. **Figma Dev Mode** shows code snippets
7. **Design tokens work**: Colors, spacing, typography apply correctly
8. **TypeScript compiles**: No type errors
9. **Path aliases resolve**: Imports like `@/components/button` work

## Future: Publish to Vercel (Later Phase)

When ready to deploy:

```bash
# Build Storybook
npm run build

# Deploy to Vercel (use Vercel MCP)
# Build command: npm run build
# Output directory: storybook-static
# Install command: npm install
```

## Key Design Decisions

1. **Vite over Next.js** - Faster, simpler for component library
2. **Copy-paste components** - Following Untitled UI pattern
3. **React Aria** - Best accessibility, matches Untitled UI
4. **Tailwind 4.1** - Already configured with tokens
5. **Manual Code Connect files** - More control over mappings
6. **No automated testing** - Keeping to bare minimum
7. **Storybook as deliverable** - Interactive documentation

## Common Pitfalls

1. **Path aliases not working** - Ensure they match in ALL config files (tsconfig, vite, figma.config, storybook)
2. **Tailwind classes not applying** - Verify globals.css imported in preview.tsx
3. **Code Connect not finding components** - Check figma.config.json include glob
4. **Untitled UI adds too much code** - Expected! Strip after import
5. **Figma properties don't match** - Property names are case-sensitive

## Success Criteria

✅ `npm run dev` shows Storybook with Button component
✅ All Button variants render correctly
✅ Props controls work in Storybook
✅ Figma tab links to design
✅ `npm run figma:connect` publishes successfully
✅ Figma Dev Mode shows code snippets
✅ Ready to add more components following the pattern
